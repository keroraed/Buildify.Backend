@page
@model Buildify.APIs.Areas.Admin.Pages.Dashboard.IndexModel
@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="container-fluid">
    <!-- Enhanced Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="dashboard-header">
                <div>
                    <h1 class="display-4 fw-bold mb-2">
                        <i class="bi bi-speedometer2 header-icon"></i> Dashboard
                    </h1>
                    <p class="text-muted mb-0">
                        <i class="bi bi-calendar3"></i> Welcome to Buildify Construction Materials Admin
                        <span class="ms-3">
                            <i class="bi bi-clock"></i> @DateTime.Now.ToString("MMMM dd, yyyy - hh:mm tt")
                        </span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle"></i> <strong>Error!</strong> @Model.ErrorMessage
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (Model.DashboardStats != null)
    {
        <!-- Statistics Cards with Modern Design -->
        <div class="row g-4 mb-4">
            <!-- Total Orders Card -->
            <div class="col-xl-3 col-md-6">
                <div class="card modern-stat-card orange-gradient h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="stat-icon-circle mb-3">
                                    <i class="bi bi-cart-check"></i>
                                </div>
                                <h6 class="text-uppercase mb-2 stat-label">Total Orders</h6>
                                <h2 class="mb-0 fw-bold stat-value">@Model.DashboardStats.TotalOrders</h2>
                                <p class="mb-0 mt-2 stat-subtext">
                                    <i class="bi bi-graph-up"></i> All time
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Total Revenue Card -->
            <div class="col-xl-3 col-md-6">
                <div class="card modern-stat-card green-gradient h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="stat-icon-circle mb-3">
                                    <i class="bi bi-currency-dollar"></i>
                                </div>
                                <h6 class="text-uppercase mb-2 stat-label">Total Revenue</h6>
                                <h2 class="mb-0 fw-bold stat-value">$@Model.DashboardStats.TotalRevenue.ToString("N2")</h2>
                                <p class="mb-0 mt-2 stat-subtext">
                                    <i class="bi bi-cash-stack"></i> Earnings
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Total Products Card -->
            <div class="col-xl-3 col-md-6">
                <div class="card modern-stat-card blue-gradient h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="stat-icon-circle mb-3">
                                    <i class="bi bi-box-seam"></i>
                                </div>
                                <h6 class="text-uppercase mb-2 stat-label">Total Products</h6>
                                <h2 class="mb-0 fw-bold stat-value">@Model.DashboardStats.TotalProducts</h2>
                                <p class="mb-0 mt-2 stat-subtext">
                                    <i class="bi bi-archive"></i> Inventory
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Total Users Card -->
            <div class="col-xl-3 col-md-6">
                <div class="card modern-stat-card yellow-gradient h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="stat-icon-circle mb-3">
                                    <i class="bi bi-people"></i>
                                </div>
                                <h6 class="text-uppercase mb-2 stat-label">Total Users</h6>
                                <h2 class="mb-0 fw-bold stat-value">@Model.DashboardStats.TotalUsers</h2>
                                <p class="mb-0 mt-2 stat-subtext">
                                    <i class="bi bi-person-check"></i> Registered
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Orders Table -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="modern-table-container">
                    <div class="table-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h4 class="mb-0 table-title">
                                <i class="bi bi-clock-history text-orange"></i> Recent Orders
                            </h4>
                            <span class="badge modern-badge">Last 10 Orders</span>
                        </div>
                    </div>
                    
                    @if (Model.DashboardStats.RecentOrders != null && Model.DashboardStats.RecentOrders.Any())
                    {
                        <div class="table-responsive">
                            <table class="table modern-table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>User ID</th>
                                        <th>Order Date</th>
                                        <th>Total Price</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var order in Model.DashboardStats.RecentOrders)
                                    {
                                        <tr>
                                            <td><strong class="text-orange">#@order.Id</strong></td>
                                            <td>
                                                <i class="bi bi-person-circle text-muted"></i> @order.UserId
                                            </td>
                                            <td>
                                                <i class="bi bi-calendar3 text-muted"></i>
                                                @order.OrderDate.ToString("MMM dd, yyyy")
                                                <br>
                                                <small class="text-muted">@order.OrderDate.ToString("hh:mm tt")</small>
                                            </td>
                                            <td>
                                                <strong class="price-tag">$@order.TotalPrice.ToString("N2")</strong>
                                            </td>
                                            <td>
                                                @{
                                                    var badgeClass = order.Status switch
                                                    {
                                                        "Pending" => "status-pending",
                                                        "Processing" => "status-processing",
                                                        "Shipped" => "status-shipped",
                                                        "Delivered" => "status-delivered",
                                                        "Cancelled" => "status-cancelled",
                                                        _ => "status-default"
                                                    };
                                                }
                                                <span class="status-badge @badgeClass">
                                                    <i class="bi bi-circle-fill"></i> @order.Status
                                                </span>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-info modern-alert">
                            <i class="bi bi-info-circle"></i> No recent orders found.
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Low Stock Products -->
        <div class="row">
            <div class="col-12">
                <div class="modern-table-container alert-container">
                    <div class="table-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h4 class="mb-0 table-title">
                                <i class="bi bi-exclamation-triangle-fill text-danger"></i> Low Stock Products
                            </h4>
                            <span class="badge danger-badge">Stock â‰¤ 10</span>
                        </div>
                    </div>
                    
                    @if (Model.DashboardStats.LowStockProducts != null && Model.DashboardStats.LowStockProducts.Any())
                    {
                        <div class="table-responsive">
                            <table class="table modern-table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Product ID</th>
                                        <th>Product Name</th>
                                        <th>Category</th>
                                        <th>Stock</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var product in Model.DashboardStats.LowStockProducts)
                                    {
                                        <tr>
                                            <td><strong class="text-orange">#@product.Id</strong></td>
                                            <td>
                                                <i class="bi bi-box text-muted"></i> @product.Name
                                            </td>
                                            <td>
                                                <span class="category-badge">@product.CategoryName</span>
                                            </td>
                                            <td>
                                                <strong class="stock-value @(product.Stock <= 5 ? "critical-stock" : "low-stock")">
                                                    <i class="bi bi-box-seam"></i> @product.Stock units
                                                </strong>
                                            </td>
                                            <td>
                                                @if (product.Stock == 0)
                                                {
                                                    <span class="status-badge status-cancelled">
                                                        <i class="bi bi-x-circle"></i> Out of Stock
                                                    </span>
                                                }
                                                else if (product.Stock <= 5)
                                                {
                                                    <span class="status-badge status-critical">
                                                        <i class="bi bi-exclamation-triangle-fill"></i> Critical
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span class="status-badge status-pending">
                                                        <i class="bi bi-exclamation-circle"></i> Low Stock
                                                    </span>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-success modern-alert">
                            <i class="bi bi-check-circle-fill"></i> All products have sufficient stock levels.
                        </div>
                    }
                </div>
            </div>
        </div>
    }
    else if (string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 text-muted">Loading dashboard data...</p>
        </div>
    }
</div>

@section Scripts {
    <style>
        :root {
            --buildify-orange: #FF6B35;
            --buildify-dark: #2C3E50;
            --buildify-yellow: #FFA500;
            --buildify-light: #ECF0F1;
        }

        /* Dashboard Header */
        .dashboard-header {
            background: linear-gradient(135deg, var(--buildify-dark) 0%, #34495E 100%);
            padding: 25px 30px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .header-icon {
            background: linear-gradient(135deg, var(--buildify-orange) 0%, var(--buildify-yellow) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 2px 4px rgba(255, 107, 53, 0.3));
        }

        /* Modern Stat Cards */
        .modern-stat-card {
            border: none;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .modern-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .modern-stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .orange-gradient {
            background: linear-gradient(135deg, #FF6B35 0%, #FFA500 100%);
            color: white;
        }

        .orange-gradient::before {
            background: linear-gradient(90deg, #FF8C00 0%, #FFD700 100%);
        }

        .green-gradient {
            background: linear-gradient(135deg, #27AE60 0%, #2ECC71 100%);
            color: white;
        }

        .green-gradient::before {
            background: linear-gradient(90deg, #1E8449 0%, #58D68D 100%);
        }

        .blue-gradient {
            background: linear-gradient(135deg, #3498DB 0%, #5DADE2 100%);
            color: white;
        }

        .blue-gradient::before {
            background: linear-gradient(90deg, #2471A3 0%, #85C1E9 100%);
        }

        .yellow-gradient {
            background: linear-gradient(135deg, #F39C12 0%, #F8C471 100%);
            color: white;
        }

        .yellow-gradient::before {
            background: linear-gradient(90deg, #D68910 0%, #FAD7A0 100%);
        }

        .stat-icon-circle {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .stat-icon-circle i {
            font-size: 1.8rem;
        }

        .stat-label {
            font-size: 0.75rem;
            letter-spacing: 1px;
            opacity: 0.9;
            font-weight: 600;
        }

        .stat-value {
            font-size: 2.2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-subtext {
            font-size: 0.85rem;
            opacity: 0.85;
        }

        /* Modern Tables */
        .modern-table-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .modern-table-container.alert-container {
            border-left: 5px solid #dc3545;
        }

        .table-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px 25px;
            border-bottom: 3px solid var(--buildify-orange);
        }

        .table-title {
            color: var(--buildify-dark);
            font-weight: 700;
        }

        .text-orange {
            color: var(--buildify-orange) !important;
        }

        .modern-badge {
            background: linear-gradient(135deg, var(--buildify-orange) 0%, var(--buildify-yellow) 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .danger-badge {
            background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .modern-table {
            margin: 0;
        }

        .modern-table thead {
            background: #f8f9fa;
            color: var(--buildify-dark);
        }

        .modern-table thead th {
            border: none;
            padding: 15px 20px;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }

        .modern-table tbody td {
            padding: 15px 20px;
            vertical-align: middle;
            border-bottom: 1px solid #f1f1f1;
        }

        .modern-table tbody tr:last-child td {
            border-bottom: none;
        }

        .modern-table tbody tr:hover {
            background-color: #fffaf6;
        }

        /* Status Badges */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-pending {
            background: #FFF3CD;
            color: #856404;
            border: 1px solid #FFE69C;
        }

        .status-processing {
            background: #D1ECF1;
            color: #0C5460;
            border: 1px solid #BEE5EB;
        }

        .status-shipped {
            background: #CCE5FF;
            color: #004085;
            border: 1px solid #B8DAFF;
        }

        .status-delivered {
            background: #D4EDDA;
            color: #155724;
            border: 1px solid #C3E6CB;
        }

        .status-cancelled, .status-critical {
            background: #F8D7DA;
            color: #721C24;
            border: 1px solid #F5C6CB;
        }

        .status-default {
            background: #E2E3E5;
            color: #383D41;
            border: 1px solid #D6D8DB;
        }

        .category-badge {
            background: linear-gradient(135deg, #6C757D 0%, #95A5A6 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        .price-tag {
            color: #27AE60;
            font-size: 1.1rem;
        }

        .stock-value {
            font-size: 1rem;
        }

        .low-stock {
            color: #F39C12;
        }

        .critical-stock {
            color: #E74C3C;
        }

        .modern-alert {
            border-radius: 10px;
            border-left: 4px solid;
            margin: 20px;
        }

        .alert-info.modern-alert {
            background: #E7F3FF;
            border-left-color: #3498DB;
            color: #2471A3;
        }

        .alert-success.modern-alert {
            background: #E8F8F5;
            border-left-color: #27AE60;
            color: #186A3B;
        }
    </style>
    
    <script>
        // Auto-refresh dashboard every 5 minutes
        setTimeout(function() {
            location.reload();
        }, 300000);
    </script>
}
